NIALM離線訓練及即時辨識之分類器軟體開發：
    本工作分項以C#及Python等程式語言開發可離線訓練及即時辨識之分類器軟體，軟體之功能如下：
(1)  可依據事先準備好之NIALM訓練資訊，以機器學習演算法建立NIALM之多標籤分類器模型。
(2)  可依據傳感器即時傳送過來的暫態電力特徵，透過已建立好之NIALM多標籤分類器模型，即時產出辨識結果。
家電設備暫態特徵資料分析主要分為幾個步驟，分別為收集、標籤、訓練與測試，以下以竹北家為示範住戶，分析家中目標家電的暫態特徵，而目標家電為冷氣機、除濕機、電鍋、微波爐、吹風機以及電視機。
首先，觀察竹北家中大金空調開啟(On)一段時間並關閉(Off)的觸發事件與暫態特徵資料，如圖3.1~圖3.5所示：

圖3.1 大金空調事件偵測(ON = 1，OFF = 0)

圖3.2 大金空調8階暫態特徵

圖3.3 大金空調電流差(Delta I)

圖3.4 大金空調暫態週期數

圖3.5 大金空調事件迴路(0、1、2)，空調標籤暫態特徵需要尋找迴路0
	從上述可以觀察到，空調開啟後將產生大量的多事件暫態特徵，亦稱為Multi Events，事件狀態有可能是1，也有可能是0。因此，需特別留意手動標籤開、關的時間到時、分以及秒，此外，由於前後時間事件很多，需要特別留意事件為１或0；迴路是否為0 (冷氣迴路為0，220V)。同時，Cycle暫態週期數量亦為參考是否有標籤錯誤的指標，若大於20，有極高機率為雜訊(Noise)。
	接著，圖3.6~圖3.10為竹北家中廚房國際牌微波爐在一段時間中開啟與關閉偵測到事件觸發與暫態特徵資料。

圖3.6 國際牌微波爐事件偵測(ON = 1，OFF = 0)

圖3.7 國際牌微波爐8階暫態特徵，紅色框內為開啟與關閉

圖3.8 國際牌微波爐電流差(Delta I)，On為正值，Off為負值

圖3.9 國際牌微波爐暫態週期數，On與Off的暫態週期數皆不高

圖3.10 國際牌微波爐事件迴路(0、1、2)，微波爐標籤暫態特徵需要尋找迴路2
	
從上述可以觀察到，與大金空調不同，微波爐從開啟到關閉的過程中，沒有任何的Multi Events，電流差(Delta I)的特徵也相當顯著，On與Off的暫態週期數皆不高，因此，初步可以推測微波爐在分類器訓練模型中，具有較佳之性能。剩餘其他家電如上述分析以此類推。
	將5種110V的目標家電(除濕機、電鍋、微波爐、吹風機以及電視機)放入t-SNE技術分析，作為判斷訓練模型性能好壞的指標方法。以下首先介紹t-SNE技術理論基礎，再分析本分項研究應用該技術實驗結果。
資料降維與視覺化：t-SNE 理論：
t-SNE（t-distributed stochastic neighbor embedding，t-隨機鄰近嵌入法）是一種非線性的機器學習降維方法，由Laurens van der Maaten和Geoffrey Hinton於2008年提出，由於t-SNE降維時保持局部結構的能力十分傑出，因此成為近年來學術論文與模型比賽中資料視覺化的常見應用，圖3.11為MNIST資料集中6,000個手寫數字的視覺化。
t-SNE演算法有以下幾個特性：
應用上，t-SNE常用來將資料投影到2維或3維的空間作定性的視覺化觀察，通過視覺化直觀的驗證某資料集或演算法的有效性。
SNE使用條件機率和高斯分佈來定義高維和低維中樣本點之間的相似度，用KL散度來衡量兩條件機率分佈總和之間的相似度，並將其作為價值函數以梯度下降法求解。
t-SNE使用t分佈定義低維時的機率分佈來減緩維數災難（curse of dimensionality）造成的擁擠問題（crowding problem）。
由於t-SNE的演算法優化是基於機率的方法，在判讀圖像時有許多要注意的地方。

圖3.11 MNIST資料集中6,000個手寫數字的視覺化

t-SNE 演算法步驟：
步驟一、將高維資料間轉換成以高斯分佈為相似度的條件機率。
分子部分可以看成高斯分佈的機率密度函數，代表著以Xi為中心的高斯分佈下，Xj的機率，機率越大，代表兩個距離越近。分母部份則是作為 Normalization 的用途，參考式3.1。

式3.1 將高維資料間轉換成以高斯分佈為相似度的條件機率
步驟二、將要轉換成的低維資料使用t分佈為相似度的條件機率。
分子部分可看成t分佈的機率密度函數（自由度為1），代表以yi為中心的 t分佈。分母部份一樣是Normalization的用途，參考式3.2。

式3.2 將要轉換成的低維資料使用t分佈為相似度的條件機率
步驟三、為了將式3.1與式3.2之間的機率分佈最相近，最小化所有資料點間的KL散度，參考式3.3。

式3.3最小化所有資料點間的KL散度
步驟四、以式3.3作為成本函數（Cost Function），並使用隨機梯度下降法（Stochastic Gradient Decent）求最佳解，參考式3.4。

式3.4隨機梯度下降法（Stochastic Gradient Decent）

困惑度Perplexity：
在高維度資料轉換為條件機率時，需要設定以Xi為中心分佈的標準差，調整方式就是設定困惑度這個參數，t-SNE會找到符合困惑度的Pi以及標準差，參考式3.5。

式3.5 設定困惑度
困惑度設定越大，此標準差就會越大，一般建議數值設定在 5 至 50 之間。圖3.12為MNIST資料集利用t-SNE繪製的結果。

圖3.12 MNIST資料集利用t-SNE繪製

總結t-SNE的特性：
非線性的降維方法
將資料點間關係以條件機率來表示，並進行降維，低維度下儘量保留同樣的條件機率。
可以找出空間中的局部特徵
常用於視覺化
隨機性-每次執行的結果都不同
本分項研究應用t-SNE技術，將不同家電的8維度暫態特徵加上電流差特徵共計9個維度特徵放入t-SNE演算法計算，收集3/4~3/19這段期間使用目標家電的暫態特徵，其中包含除濕機、電鍋、微波爐、吹風機、電視，作為欲訓練家電暫態特徵模型的資料，參考表3.1，除濕機開與關各20筆；電鍋開與關各30筆；微波爐和吹風機開關各30筆；電視機開關各20筆。

表3.1 欲訓練家電暫態特徵模型的資料(部分示意)

以下將開啟狀態(On)與關閉狀態(Off)各別分析；以110V家電為範例，t-SNE結果如圖3.13與圖3.14所示。

圖3.13 110V On t-SNE結果

圖3.14 110V Off t-SNE結果
從研究結果來看，110V家電狀態關閉(Off)的t-SNE分布良好，同種家電特徵分布集中，不同家電之間明顯區分開來，由此可以推測其110V的Off訓練模型性能將會良好。另外，110V家電狀態開啟(On)的t-SNE分布也不錯，平均每個家電約有2~3個離群值以外，其他特徵分布皆集中，由此可以推測其110V的On訓練模型性能亦會不錯。
傳感器原始資料(Raw Data)於PC平台運算暫態特徵演算法開發：
	本技術內容共分為以下幾個步驟，流程架構如圖3.15所示：

3.15 PC平台運算暫態特徵演算法流程架構
	首先，現場入戶收集傳感器原始資料，例如空調開/關各四次、電視開/關一次以及微波爐開關各一到兩次。共計耗時約為1小時30分以上。接著，PC版擷取傳感器原始資料(約6000點Raw data)後端處理，處理內容為小波轉換，以下介紹小波轉換之演算法，並完成於PC版開發環境為VS之C#程式。
小波轉換：
多貝西小波(Daubechies Wavelet)，是以比利時女性物理暨數學家英格麗·多貝西(Ingrid Daubechies)的名字命名之一種小波函數，當初英格麗·多貝西提出一種具有階層(hierarchy)性質的小波，便將此小波以她的名字命名。多貝西小波主要應用在離散型的小波轉換，是最常使用到的小波轉換，通常使用在數位信號分析、信號壓縮跟雜訊去除。
一般而言的離散小波轉換通常是以正交小波(orthogonal wavelet)為基底，而多貝西小波也是一種正交小波。由於它很容易經由快速小波轉換(fast wavelet transform(FWT))實現，所以常會應用在數位信號處理。
對於有限長度的小波，應用於快速小波轉換(fast wavelet transform(FWT))時，會有兩個實數組成的數列：一是作為高通濾波器的係數，稱作小波濾波器(wavelet filter,也稱為mother wavelet)；二是低通濾波器的係數，稱作調整濾波器(scaling filter,也稱為father wavelet)。
以濾波器的長度N來形容濾波器為DN，例如：N=2的多貝西小波寫作D2、N=4的多貝西小波寫作D4，以此類推(N為偶數)。實際上常用的多貝西小波為D2到D20。與之對應的另一種描述方式是db N，其中N指消失矩的數量，由此，D4和db2是同一種多貝西小波，本研究應用小波轉換的長度為4，即為db4。
分類方式：
多貝西小波的分類是以消失動量(vanishing moment)的值A(亦為消失動量的個數)為依據(A稱為tap)，調整函式(scaling function)及小波函式(wavelet function)的平滑度(smoothness)皆會隨著消失動量的值(tap)增加而增加：例如，當A=1時，多貝西小波即是哈爾小波(Haar wavelet)，調整函式及小波函式都是不連續的；當A=2時，多貝西小波的調整函式及小波函式為不能平滑微分的連續函式；當A=3時，調整函式及小波函式已經是連續可微的函式了。以此類推，當A愈大時，多貝西小波的兩個函式平滑度會愈來愈高。以下圖3.16為多貝西小波跟不同A的調整及小波函式圖：


圖3.16為多貝西小波跟不同A的調整及小波函式

接著，本研究利用程式計算每一個Cycle的平方和(共36個Cycles)，參考式3.6，然後設定閥值(Threshold)；開始尋找T1與T2。

式3.6 每一個Cycle平方和計算方式

T1與T2的閥值調整為從10%尋找至7%(利用For迴圈，每次降1%)，接著，計算暫態特徵區間的Cycle數量，若小於5個Cycles，則以5個Cycles作為暫態特徵區間。On事件暫態區間的Cycle數若小於5，則往右補至5個Cycles，即T2往右；Off事件暫態區間的Cycle數若小於5，則往左補至5個Cycles，即T1往左。最後，計算起始點T1與終點T2的Cycle位置，亦稱為帕塞瓦爾定理(Parseval's Theorem)。帕塞瓦爾定理(Parseval's Theorem)介紹如下：
帕塞瓦爾定理(Parseval's Theorem)：
在數學中，帕塞瓦爾定理(或稱帕塞瓦爾等式)，經常指「傅立葉轉換是么正算符」這一結論；簡而言之，就是說函數平方的和(或積分)等於其傅立葉轉換式平方之和(或者積分)。這個定理產生於馬克-安托萬·帕塞瓦爾在1799年所得到的一個有關級數的定理，該定理隨後被應用於傅立葉級數。它也被稱為瑞利能量定理或瑞利恆等式，以物理學家瑞利命名。
該定理是勾股定理在希爾伯特空間或更廣泛的內積空間中的推廣，或者說勾股定理是帕塞瓦爾定理在定義了內積的二維歐氏空間中的特例。本研究技術應用帕塞瓦爾定理(Parseval's Theorem)實作於PC平台運算暫態特徵，參考示意如表3.2所示，PC平台運算暫態特徵演算法與傳感器一致。

表3.2 電鍋小波轉換D1~D8(總共8階)示意10個點(一個錄波總共約6000點)

	圖3.17到圖3.20為PC Base利用VS之Windows Form UI平台呈現運算空調與電視暫態特徵週期數與分布狀況，皆為C#程式語言實踐其傳感器運算結果。

圖3.17 空調On的原始資料

圖3.18 空調Off的原始資料

圖3.19 電視On的原始資料

圖3.20 電視Off的原始資料

暫態特徵資料標籤與收集PC版程式開發：
	為了提高現場入戶安裝傳感器人員收集家電暫態特徵的效率，以及盡量不擾民的前提下，本分項研究開發一個以VS環境利用C#建置的暫態特徵資料標籤與收集程式，其Windows Form的UI介面參考圖3.21所示：

圖 3.21 暫態特徵資料標籤與收集PC版程式UI介面
	從上圖中可以看到，操作人員首先需要輸入該示範住戶電號，並嘗試與MQTT通訊連接。成功連線後，即會顯示「MQTT is connected!」訊息，並且在下方空白處顯示「最新一筆」事件偵測。所偵測到的事件內容包含日期、時間、八階暫態特徵、事件狀態(0或1)、迴路(0、1或2)以及電流差之穩態特徵。除此之外，為了能夠有效訓練雜訊，在家電的種類中，下拉式選單可以選擇「雜訊」作為標籤暫態特徵事件之一，參考圖3.22所示：

圖3.22 UI介面中，家電下拉式選單可以選擇雜訊

表3.3與表3.4分別為在竹北家中利用不同時間區段確定無人操作目標家電時，標籤雜訊的暫態特徵，主要分為兩類型，第一類型為半夜睡覺時段，確定無使用任何家電，推測為待機電力或是基本電力的雜訊(冰箱壓縮機啟停)所產生的暫態特徵事件；第二類型為空調運轉過程，迴路為0，事件狀態與電流差不一致，推測為空調的Multi Events所產生的暫態特徵事件。

表3.3第一類型雜訊(Noise)部分示意


表3.4第二類型雜訊(Noise)部分示意

	在Windows Form的UI介面下方可以看到所有家電標籤代碼，主要目的作為背景家電訓練模型的資料夾與檔案分類，參考圖3.23，每個家電之代碼總共由6碼組成，前兩碼為家電種類；中間兩碼為廠牌；最後兩碼為型號。

圖3.23 背景家電訓練模型的資料夾與檔案分類
	XGBOOST分類器模型為目前NILM國際學術研究整理歸納其精準度最高之技術與演算法，本研究將欲訓練的家電暫態特徵分為四類作為訓練模型的輸入(Input)，分別為110V家電的On、110V家電的Off、220V家電的On以及220V家電的Off，檔案格式皆為CSV檔案，參考示意如表3.5：

表3.5 欲訓練家電暫態特徵模型的資料(部分示意)

	根據上表中不同的事件狀態以及迴路，將所標籤到的家電分類在相對應類型的訓練模型輸入源(四個分類其中一類)，再進行XGBOOST分類器訓練。以下將介紹XGBOOST演算法及特性。

XGBOOST：
XGboost全名為eXtreme Gradient Boosting，是目前Kaggle競賽中最常見到的算法，同時也是多數得獎者所使用的模型。此機器學習模型是由華盛頓大學博士生陳天奇所提出來的，它是以Gradient Boosting為基礎下去實作，並添加一些新的技巧。它可以說是結合Bagging和Boosting的優點。XGboost保有Gradient Boosting的做法，每一棵樹是互相關聯的，目標是希望後面生成的樹能夠修正前面一棵樹犯錯的地方。此外XGboost是採用特徵隨機採樣的技巧，和隨機森林一樣在生成每一棵樹的時候隨機抽取特徵，因此在每棵樹的生成中並不會每一次都拿全部的特徵參與決策。此外為了讓模型過於複雜，XGboost在目標函數添加了標準化。因為模型在訓練時為了擬合訓練資料，會產生很多高次項的函數，但反而容易被雜訊干擾導致過度擬合。因此 L1/L2 Regularization目的是讓損失函數更佳平滑，且抗雜訊干擾能力更大。最後XGboost還用到了一階導數和二階導數來生成下一棵樹。其中Gradient就是所謂的一階導數，而Hessian即為二階導數，Bagging和Boosting參考圖3.24示意：


圖3.24 Bagging和Boosting演算法架構

首先，Bagging透過隨機抽樣的方式生成每一棵樹，最重要的是每棵樹彼此獨立並無關聯。先前所提到的隨機森林就是Bagging的實例。另外，Boosting則是透過序列的方式生成樹，後面所生成的樹會與前一棵樹相關。XGBoost就是 Boosting方法的其中一種實例。每棵樹的生成都改善了上一棵樹學習不好的地方，因此，Boosting的模型通常會比Bagging還來的精準。再與所提的決策樹做比較，決策樹通常為一棵複雜的樹，而在Boosting是產生非常多棵的樹，但是每一棵的樹都很簡單的決策樹。Boosting希望新的樹可以針對舊的樹預測不太好的部分做一些補強。最終要把所有簡單的樹合再一起才能當最後的預測輸出。分類與回歸樹(Classification And Regression Tree/CART)是一種決策樹，可以用於分類和回歸， CART的每次劃分都把一棵樹劃分成兩棵子樹，如圖3.25所示。

圖3.25 CART把一棵樹劃分成兩棵子樹

XGBoost可想成多個CART進行融合，如圖3.26所示，可以把兩棵樹的輸出加起來得到最終的輸出。

圖3.26 XGBoost如同多個CART進行融合

XGBoost除了可以做分類也能進行迴歸連續性數值的預測，而且效果通常都不差。並透過Boosting技巧將許多弱決策樹集成在一起形成一個強的預測模型。優點如下：
利用了二階梯度來對節點進行劃分
利用局部近似算法對分裂節點進行優化
在損失函數中加入了 L1/L2 項，控制模型的複雜度
提供 GPU 平行化運算

本分項研究在3月21號收集欲測試驗證的家電暫態特徵，目標家電種類包含除濕機、電鍋、微波爐、吹風機以及電視。其中，除濕機開/關各9筆；電鍋開/關各20筆；微波爐開/關各10筆；吹風機開啟總共19筆，關閉總共20筆；電視機開啟總共7筆，關閉總共6筆。在整日的資料統計中，總共事件312筆，觸發訓練模型家電開關的事件共130筆，雜訊(非訓練模型家電或待機電力等)共182筆，110V雜訊主要來源為非目標家電開關、待機電力、冰箱壓縮機啟停以及電熱類保溫壺的多事件(Multi Events)，雜訊暫態特徵與電視十分相似，容易被預測為電視開關。以下將介紹利用F-score指標驗證識別家電開關精準度的方法。
F-score：
	亦被稱做F-measure，是一種量測算法的精確度常用的指標，經常用來判斷演算法的精確度。目前在辨識、偵測相關的演算法中經常會分別提到精確率(Precision)和召回率(Recall)，F-score能同時考慮這兩個數值，平衡地反映這個演算法的精確度。
	F-score的組成元素包含TP、FN、FP以及TN，參考表3.6以及圖3.27所示：
TP(true positive，真陽性)：演算法判斷為真，這個判斷是對的。即事實上為真，而且被該演算法判斷為真的情形。
FN(false negative，假陰性)：演算法判斷為不真，這個判斷是錯的。即事實上為真，卻被演算法判斷為不真的情形。
FP(false positive，假陽性)：演算法判斷為真，這個判斷是錯的。即事實上不為真，卻被演算法誤判為真的情形。
TN(true negative，真陰性)：演算法判斷為不真，這個判斷是對的。即事實上不為真，而且被演算法判斷成不為真的情形。
表3.6 混淆矩陣表



圖3.27 TP、FN、FP以及TN示意
	
用來判斷準確度的衡量指標包含Precision、Recall以及F-score，公式參考式3.7~式3.9：

式3.7 Precision計算公式

式3.8 Recall計算公式

式3.9 F-score計算公式

	以下先分析鳳山實驗屋各個目標家電之開啟狀態(On)與關閉狀態(Off)的Precision、Recall以及F-score，並且分為「沒有包含」雜訊以及「有包含」雜訊作為分析結果，參考表3.7與表3.8所示：

表3.7 鳳山實驗屋「沒有包含」雜訊之目標家電準確度結果
表3.8 鳳山實驗屋「有包含」雜訊之目標家電準確度結果


	從上表觀察，「沒有包含」雜訊之目標家電準確度在鳳山實驗屋可以高達90%甚至100%；然而，「有包含」雜訊之目標家電準確度結果來看，除濕機、電風扇以及電視機的Precision明顯下降很多，導致F-score運算結果較低，其最主要原因為雜訊的暫態特徵與除濕機、電風扇以及電視機的暫態特徵十分相似，在t-SNE分布上也有較多重疊之處。表3.9與表3.10為竹北示範住戶各個目標家電之開啟狀態(On)與關閉狀態(Off)的Precision、Recall以及F-score，並且分為「沒有包含」雜訊以及「有包含」雜訊作為分析結果。
表3.9 竹北示範住戶「沒有包含」雜訊之目標家電準確度結果

表3.10 竹北示範住戶「有包含」雜訊之目標家電準確度結果


	從上表觀察，「沒有包含」雜訊之目標家電準確度在竹北示範住戶可以高達趨近100%；然而，「有包含」雜訊之目標家電準確度結果來看，電視機的Precision明顯下降很多，導致F-score運算結果較低，其最主要原因為雜訊的暫態特徵與電視機的暫態特徵十分相似，在t-SNE分布上也有較多重疊之處。因此，本實驗研究提出一個利用「機率差」過濾雜訊的方法，使整體目標家電之辨識率提高，將在後續作說明。
利用機率差過濾雜訊：
	XBGOOST分類器演算法輸出為家電預測機率分布，機率最大值為家電與狀態預測結果，參考表3.11所示。將機率最大值家電減去機率次大值家電作為閥值(Threshold)，本研究將閥值設定為0.1~0.9作為實驗分析，若小於等於閥值，則判斷為雜訊(Noise)，並過濾掉。
表3.11 機率差過濾(Threshold)示意表

	其中，實際值若為0，代表雜訊，負號代表狀態“關”； 機率差為最大機率減去次大機率。以下表3.12~表3.17先分析鳳山實驗屋利用機率差過濾雜訊後之目標家電辨識開關狀態準確度結果，Precision、Recall以及F-score各別計算，並將家電開啟與關閉狀態區分開來。

表3.12 鳳山實驗屋On-Precision，Threshold=0.1~0.9


表3.13 鳳山實驗屋On-Recall，Threshold=0.1~0.9

表3.14 鳳山實驗屋Off-Precision，Threshold=0.1~0.9

表3.15 鳳山實驗屋Off-Recall，Threshold=0.1~0.9

表3.16 鳳山實驗屋On-F-score，Threshold=0.1~0.9

表3.17 鳳山實驗屋Off-F-score，Threshold=0.1~0.9

	從鳳山實驗屋結果來看，利用機率差的方法確實可以有效過濾雜訊(Noise)，On-Precision利用該方法準確度可以提升到70%；此外，F-Score利用該方法準確度可以提升到約70%。當閥值設定為0.7~0.8，實驗研究結果性能最佳，然而，利用機率差過濾雜訊為一雙面刃，亦會有可能把真實實際值過濾掉。
接著，利樣同樣的方式，表3.18~表3.23分析竹北示範住戶利用機率差過濾雜訊後之目標家電辨識開關狀態準確度結果，Precision、Recall以及F-score各別計算，並將家電開啟與關閉狀態區分開來。
表3.18 竹北示範住戶On-Precision，Threshold=0.1~0.9

表3.19 竹北示範住戶On-Recall，Threshold=0.1~0.9

表3.20 竹北示範住戶Off-Precision，Threshold=0.1~0.9


表3.21 竹北示範住戶Off-Recall，Threshold=0.1~0.9

表3.22 竹北示範住戶On-F-score，Threshold=0.1~0.9

表3.23 竹北示範住戶Off-F-score，Threshold=0.1~0.9

	從竹北示範住戶結果來看，利用機率差的方法亦確實可以有效過濾雜訊(Noise)，On-Precision利用該方法準確度可以提升到75%；Off-Precision利用該方法準確度可以提升到76.5%；此外，F-Score利用該方法準確度可以提升到約76%~78%。同樣地，當閥值設定為0.7~0.8，實驗研究結果性能最佳，因此，後續分析將閥值設定收斂至0.5~0.9。然而，利用機率差過濾雜訊為一雙面刃，亦會有可能把真實實際值過濾掉。在驗證目標家電開啟與關閉狀態的過程中，仍需注意家電過度頻繁開關容易導致家電損壞。所有家電開啟後(On)，需要間隔至少一段時間(30秒以上)，再關閉家電，所收集量測到的關閉(Off)之暫態特徵較為集中，也較符合一般家庭使用家電的行為。目標家電當中，廚房烹飪煮食家電預測準確度高，如電鍋與微波爐。由於電視特徵與雜訊相近，預測準確度較低。
截至上述研究分析結果，在分類器訓練模型中並沒有標籤訓練雜訊暫態特徵，本分項實驗研究亦實作「訓練」雜訊於分類器模型，並分析與驗證其目標家電開關狀態辨識準確度，如同上述作法，表3.24為竹北示範住戶模型包含訓練雜訊的目標家電準確度結果。
表3.24 竹北示範住戶模型訓練雜訊之準確度

	相同地，XBGOOST分類器演算法輸出為家電預測機率分布，機率最大值為家電與狀態預測結果。將機率最大值家電減去機率次大值家電作為閥值(Threshold)，由於閥值設定為0.7~0.8，實驗研究結果性能最佳，因此，將閥值設定為0.5~0.9作為實驗分析並比較，若小於等於閥值，則判斷為雜訊(Noise)，並過濾掉，表3.25~表3.30為模型沒有訓練雜訊與模型有訓練雜訊透過機率差過濾雜訊後的準確度比較，閥值皆從0.5~0.9作為相互比較的設定。
表3.25 竹北戶On-Precision，模型有無訓練雜訊比較，Threshold=0.5~0.9


表3.26 竹北戶On-Recall，模型有無訓練雜訊比較，Threshold=0.5~0.9

表3.27 竹北戶Off-Precision，模型有無訓練雜訊比較，Threshold=0.5~0.9


表3.28 竹北戶Off-Recall，模型有無訓練雜訊比較，Threshold=0.5~0.9

表3.29 竹北戶On-F-score，模型有無訓練雜訊比較，Threshold=0.5~0.9

表3.30 竹北戶Off-F-score，模型有無訓練雜訊比較，Threshold=0.5~0.9

	從上述實驗研究結果可以觀察，竹北示範住戶新增標籤雜訊並納入訓練模型可有效提升準確度達73%，除此之外，再利用機率差的方法確實可以有效過濾雜訊(Noise)並精進準確度。其中，On-Precision利用該方法準確度可以提升到將近79%；Off-Precision利用該方法準確度可以提升到93%；F-Score利用該方法準確度可以提升到約80%。當閥值設定為0.7~0.9，實驗研究結果性能最佳，然而，儘管準確度提升至8成以上，利用機率差過濾雜訊這方法同樣亦會有可能把真實實際值過濾掉。
	因此，本分項研究再提出另一種方法，先觀察事件觸發時，分析事件的狀態(0或1)、迴路(0、1或2)、暫態週期數以及電流差(Delta I)，作為邏輯判斷是否進入預測解析目標家電開關狀態的分類器模型參考依據，作預先前處理的程序。表3.31為觀察到待機電力與基本電力雜訊，其電流差(Delta I)皆在介於-0.3~+0.3之間。
表3.31 待機與基本電力雜訊電流差介於-0.3~+0.3之間

	除此之外，觀察到多事件(Multi Events)的雜訊在110V家電中，暫態週期數皆大於20，參考表3.32所示：

表3.32 Multi Events雜訊，暫態週期數>20

	藉由了解竹北示範住戶雜訊特性，定義過濾雜訊的前處理條件如下：
待機電力、基本電力：
電流差(Delta I)介於-0.3~+0.3之間
Multi Events雜訊：
110V：
暫態週期數>20
220V：
暫態週期數>20
事件狀態與電流差不一致，例如事件狀態為1；電流差<0
利用以上特性作為事件觸發時，進入預測模型前篩選過濾雜訊的閥值(Threshold)。統計竹北示範住戶進入預測模型前事件，總共事件312筆，觸發訓練模型家電開關的事件共130筆，篩選過濾掉3筆；雜訊(非訓練模型家電或待機電力等)共182筆，篩選過濾掉94筆。所以，事件剩餘共215筆(127筆目標家電事件 + 88筆雜訊)。表3.33為利用預先前處理過濾雜訊的方法驗證目標家電辨識開關狀態準確度結果。
表3.33 利用預先前處理過濾雜訊的方法


從上表可以觀察到，事件觸發時，進入預測模型前篩選過濾事件，再丟入模型預測，可有效提升準確度達74%，特別值得注意的是，此方法不需要額外訓練雜訊，除此之外，此方法不需要在預測完後，再利用機率差過濾雜訊。而且，篩選過濾掉真實事件的比例很低。然而，該方法必須要了解住戶的雜訊特性，可能需要在安裝完成傳感器後，觀察該住戶2~3天，並且需要與住戶作互動，使住戶提供相關回饋訊息，以利於排除雜訊，提升辨識目標家電開關狀態的準確度。
小結：
本工作分項以C#及Python等程式語言完成NIALM離線訓練及即時辨識之分類器軟體開發，軟體之功能如下：
可依據事先準備好之標籤目標家電暫態特徵訓練資訊，以XGBOOST分類器演算法建立NIALM訓練模型，共有四個模型，分別為110V家電On狀態的模型、110V家電Off狀態的模型、220V家電On狀態的模型以及220V家電Off狀態的模型。
可依據傳感器即時傳送過來的暫態電力特徵，透過已建立好之NIALM多標籤分類器模型，即時產出辨識結果。
PC平台可以處理分析運算傳感器原始資料包含：
每一個Cycle計算平方和或是RMS
T1與T2閥值大小設定
小波轉換(Discrete Wavelet Transform，DWT)
帕塞瓦爾定理(Parseval's Theorem)

本分項計畫研究利用機率差的方法確實可以有效過濾雜訊(Noise)，並且提升辨識目標家電開關狀態的準確度達到78%；另外，新增標籤雜訊並納入訓練模型可有效提升準確度至約80%，其中，Off-Precision利用該方法準確度可以提升到93%。在驗證目標家電開啟與關閉狀態的過程中，仍需注意家電過度頻繁開關容易導致家電損壞。所有家電開啟後(On)，需要間隔至少一段時間(30秒以上)，再關閉家電，所收集量測到的關閉(Off)之暫態特徵較為集中，也較符合一般家庭使用家電的行為。目標家電當中，廚房烹飪煮食家電預測準確度高，如電鍋與微波爐。由於電視特徵與雜訊相近，預測準確度較低。在後續入戶安裝傳感器並且收集家電暫態特徵的過程中仍需注意並觀察上述事項，以避免打擾示範住戶日常生活行為習慣。